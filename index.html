<html w-tid="0">

<head w-tid="1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="My App"> 
  <style>
    html {
      min-height: 100%
    }

    .ctxmenu {
      position: fixed;
      border: 1px solid #999;
      padding: 2px 0;
      box-shadow: #aaa 3px 3px 3px;
      background: #fff;
      margin: 0;
      z-index: 9999;
      overflow-y: auto;
      font: 15px Verdana, sans-serif;
      box-sizing: border-box
    }

    .ctxmenu li {
      margin: 1px 0;
      display: block;
      position: relative;
      user-select: none
    }

    .ctxmenu li.heading {
      font-weight: bold;
      margin-left: -5px
    }

    .ctxmenu li span {
      display: block;
      padding: 2px 20px;
      cursor: default
    }

    .ctxmenu li a {
      color: inherit;
      text-decoration: none
    }

    .ctxmenu li.icon {
      padding-left: 15px
    }

    .ctxmenu img.icon {
      position: absolute;
      width: 18px;
      left: 10px;
      top: 2px
    }

    .ctxmenu li.disabled {
      color: #ccc
    }

    .ctxmenu li.divider {
      border-bottom: 1px solid #aaa;
      margin: 5px 0
    }

    .ctxmenu li.interactive:hover {
      background: rgba(0, 0, 0, .1)
    }

    .ctxmenu li.submenu::after {
      content: "";
      position: absolute;
      display: block;
      top: 0;
      bottom: 0;
      right: .4em;
      margin: auto .1rem auto auto;
      border-right: 1px solid #000;
      border-top: 1px solid #000;
      transform: rotate(45deg);
      width: .3rem;
      height: .3rem
    }

    .ctxmenu li.submenu.disabled::after {
      border-color: #ccc
    }
  </style>
  <base href="" simulated-href="/" w-tid="2">
  <link rel="stylesheet" href="/fonts.css?v=41af5fbe8025dabf8b0739385b75e80d69fa8cfd">
  <link rel="stylesheet" href="/ctxmenu.css?v=41af5fbe8025dabf8b0739385b75e80d69fa8cfd">



  <meta charset="UTF-8" w-tid="3">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" w-tid="4">
  <link rel="icon" href="https://i.imgur.com/5eikbcV.png" type="image/png" w-tid="5">
  <title w-tid="6">Li-Ai</title>
  <style w-tid="7">
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Open+Sans:wght@400;600&display=swap');

    :root {
      --primary-color: #6a11cb;
      --secondary-color: #2575fc;
      --text-color: #ffffff;
      --background-color: #1a1a2e;
      --chat-background: rgba(255, 255, 255, 0.05);
      --user-message-color: #4ecdc4;
      --bot-message-color: #45aaf2;
      --input-background: rgba(255, 255, 255, 0.1);
      --button-color: #ff6b6b;
      --button-hover-color: #ff8787;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: var(--text-color);
      justify-content: center;
      min-height: 100vh;
    }

    .chat-container {
      background-color: var(--background-color);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      background-color: var(--chat-background);
      color: var(--text-color);
      padding: 20px;
      text-align: center;
      font-family: 'Montserrat', sans-serif;
      font-size: 1.4em;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-title {
      flex-grow: 1;
    }

    .restart-button {
      background-color: var(--button-color);
      color: var(--text-color);
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.8em;
      transition: all 0.3s ease;
    }

    .restart-button:hover {
      background-color: var(--button-hover-color);
      transform: scale(1.05);
    }

    .chat-messages {
      flex-grow: 1;
      height: 100vh;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .message {
      max-width: 80%;
      margin-bottom: 15px;
      padding: 12px 16px;
      border-radius: 20px;
      animation: fadeIn 0.5s;
      word-wrap: break-word;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .user-message {
      background-color: var(--user-message-color);
      color: var(--background-color);
      align-self: flex-end;
      border-bottom-right-radius: 5px;
    }

    .bot-message {
      background-color: var(--bot-message-color);
      color: var(--text-color);
      align-self: flex-start;
      border-bottom-left-radius: 5px;
    }

    .chat-input {
      display: flex;
      padding: 20px;
      background-color: var(--chat-background);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    #user-input {
      flex-grow: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      background-color: var(--input-background);
      color: var(--text-color);
      font-size: 16px;
      transition: all 0.3s ease;
    }

    #user-input:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
    }

    .input-button {
      width: 50px;
      height: 50px;
      margin-left: 10px;
      border: none;
      border-radius: 50%;
      background-color: var(--button-color);
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .input-button:hover {
      background-color: var(--button-hover-color);
      transform: scale(1.05);
    }

    .input-button:active {
      transform: scale(0.95);
    }

    #image-upload {
      display: none;
    }

    .loading {
      align-self: flex-start;
      margin-bottom: 15px;
    }

    .loading-dots {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: rgba(69, 170, 242, 0.3);
      border-radius: 20px;
      padding: 10px 15px;
    }

    .loading-dot {
      width: 8px;
      height: 8px;
      background-color: var(--text-color);
      border-radius: 50%;
      margin: 0 3px;
      animation: bounce 1.4s infinite ease-in-out both;
    }

    .loading-dot:nth-child(1) {
      animation-delay: -0.32s;
    }

    .loading-dot:nth-child(2) {
      animation-delay: -0.16s;
    }

    @keyframes bounce {

      0%,
      80%,
      100% {
        transform: scale(0);
      }

      40% {
        transform: scale(1);
      }
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    .uploaded-image {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    #image-preview {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      display: none;
      margin-left: 10px;
      border: 2px solid var(--text-color);
    }

    pre {
      background-color: rgba(0, 0, 0, 0.1);
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
    }

    code {
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9em;
    }

    h1,
    h2 {
      margin-top: 10px;
      margin-bottom: 5px;
    }

    h1 {
      font-size: 1.5em;
    }

    h2 {
      font-size: 1.3em;
    }

    @media (max-width: 480px) {
      .chat-container {
        border-radius: 0;
        height: 100vh;
      }

      .chat-messages {
        height: calc(100vh - 140px);
      }
    }
  </style>
</head>

<body w-tid="8">
  <div class="chat-container" w-tid="9">
    <div class="chat-header" w-tid="10">
      <div class="chat-title" w-tid="11">ChatBot</div>
      <button class="restart-button" id="restart-button" w-tid="12"><svg width="24" height="24" viewBox="0 0 24 24"
          fill="none" xmlns="http://www.w3.org/2000/svg" w-tid="13" class="">
          <path
            d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
            fill="currentColor" w-tid="14"></path>
        </svg></button>
    </div>
    <div class="chat-messages" id="chat-messages" w-tid="15">
    </div>
    <div class="chat-input" w-tid="16">
      <input type="text" id="user-input" placeholder="Type your message..." w-tid="17">
      <button class="input-button" id="image-button" w-tid="18">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" w-tid="19">
          <path
            d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"
            fill="currentColor" w-tid="20"></path>
        </svg>
      </button>
      <input type="file" id="image-upload" accept="image/*" w-tid="21">
      <img id="image-preview" src="#" alt="Image preview" w-tid="22" data-image_id="0" class="websim-loading">
      <button class="input-button" id="send-button" w-tid="23">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" w-tid="24">
          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" fill="currentColor" w-tid="25"></path>
        </svg>
      </button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js" w-tid="26"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js" w-tid="27"></script>
  <script w-tid="28">
    const API_URL = "https://openrouter.ai/api/v1/chat/completions";
    const ENCRYPTED_API_KEY = "U2FsdGVkX19yvWTKX7phTb187mjVYLIATMuj/vPJ3kJ0lx52lMA4ugj9QwfBprbd5kjxSUnI+v6UaWD4gV5MUh7w2u+Kw6JOG+4gwV05rDWd5/19rJa9FYa/wHBoENkh";

    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const imageButton = document.getElementById('image-button');
    const imageUpload = document.getElementById('image-upload');
    const imagePreview = document.getElementById('image-preview');
    const restartButton = document.getElementById('restart-button');

    let uploadedImageBase64 = null;
    let conversationHistory = [];
    let isPasswordEntered = false;
    let decryptedApiKey = '';

    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function addMessage(content, isUser = false, imageUrl = null) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message');
      messageElement.classList.add(isUser ? 'user-message' : 'bot-message');

      if (content) {
        const textNode = document.createElement('div');
        textNode.innerHTML = content;
        messageElement.appendChild(textNode);
      }

      if (imageUrl) {
        const imageNode = document.createElement('img');
        imageNode.src = imageUrl;
        imageNode.alt = 'Uploaded Image';
        imageNode.classList.add('uploaded-image');
        messageElement.appendChild(imageNode);
      }

      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      if (isUser) {
        conversationHistory.push({
          role: "user",
          content: content,
          imageUrl: imageUrl
        });
      }
    }

    function convertMarkdownToHtml(text) {
      text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, language, code) => {
        return `<pre><code class="language-${language || ''}">${escapeHtml(code.trim())}</code></pre>`;
      });
      text = text.replace(/^###\s(.+)$/gm, '<h2>$1</h2>');
      text = text.replace(/`([^`]+)`/g, '<strong>$1</strong>');
      text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      text = text.replace(/\n/g, '<br>');
      return text;
    }

    function addLoadingIndicator() {
      const loadingElement = document.createElement('div');
      loadingElement.classList.add('loading');
      loadingElement.innerHTML = `
              <div class="loading-dots">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
              </div>
            `;
      chatMessages.appendChild(loadingElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      return loadingElement;
    }

    function resetImageInput() {
      uploadedImageBase64 = null;
      imagePreview.style.display = 'none';
      imagePreview.src = '#';
      imageButton.style.display = 'flex';
      imageUpload.value = '';
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          uploadedImageBase64 = e.target.result;
          imagePreview.src = uploadedImageBase64;
          imagePreview.style.display = 'block';
          imageButton.style.display = 'none';
        };
        reader.readAsDataURL(file);
      }
    }

    async function sendMessage() {
      const message = userInput.value.trim();
      if (message || uploadedImageBase64) {
        if (!isPasswordEntered) {
          checkPassword(message);
        } else {
          if (uploadedImageBase64 && !message) {
            alert('Please write a message along with the image.');
            return;
          }
          addMessage(message, true, uploadedImageBase64);
          userInput.value = '';

          const loadingIndicator = addLoadingIndicator();

          try {
            const messages = conversationHistory.map(msg => ({
              role: msg.role,
              content: msg.content
            }));

            const content = [{ type: "text", text: message }];
            if (uploadedImageBase64) {
              content.push({
                type: "image_url",
                image_url: {
                  url: uploadedImageBase64,
                  detail: "low"
                }
              });
            }

            messages.push({ role: "user", content });

            const payload = {
              stream: true,
              model: "mistralai/pixtral-12b:free",
              messages: messages,
              transforms: ["middle-out"],
              max_tokens: 0
            };

            const response = await fetch(API_URL, {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${decryptedApiKey}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(payload)
            });

            loadingIndicator.remove();
            await handleStreamingResponse(response);
          } catch (error) {
            console.error('Error:', error);
            loadingIndicator.remove();
            addMessage('Sorry, I encountered an error. Please try again later.');
          }

          resetImageInput();
        }
      }
    }

    async function handleStreamingResponse(response) {
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let botReply = '';
      const botMessageElement = document.createElement('div');
      botMessageElement.classList.add('message', 'bot-message');
      chatMessages.appendChild(botMessageElement);

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split('\n');
        for (const line of lines) {
          if (line.startsWith('data: ')) {
            try {
              const jsonData = JSON.parse(line.slice(6));
              if (jsonData.choices && jsonData.choices[0].delta && jsonData.choices[0].delta.content) {
                botReply += jsonData.choices[0].delta.content;
                botMessageElement.innerHTML = convertMarkdownToHtml(botReply);
                chatMessages.scrollTop = chatMessages.scrollHeight;
              }
            } catch (error) {
              console.error('Error parsing JSON:', error);
            }
          }
        }
      }

      conversationHistory.push({
        role: "assistant",
        content: botReply
      });
    }

    function restartConversation() {
      conversationHistory = [];
      chatMessages.innerHTML = '';
      isPasswordEntered = false;
      addMessage('Please enter the password to start the conversation.');
    }

    function checkPassword(password) {
      try {
        // Attempt to decrypt the encrypted API key using the provided password
        const decrypted = CryptoJS.AES.decrypt(ENCRYPTED_API_KEY, password).toString(CryptoJS.enc.Utf8);

        // Check if the decrypted key starts with the expected prefix "sk-or-v1-"
        if (decrypted.startsWith("sk-or-v1-")) {
          isPasswordEntered = true;
          decryptedApiKey = decrypted;
          addMessage('Password correct. You can now start the conversation.');
        } else {
          addMessage('Incorrect password. Please try again.');
        }
      } catch (error) {
        // If an error occurs during decryption (e.g., wrong password), handle it gracefully
        addMessage('Incorrect password or decryption failed. Please try again.');
      }

      userInput.value = '';  // Clear the input field
    }


    restartButton.addEventListener('click', restartConversation);
    sendButton.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    imageButton.addEventListener('click', () => {
      imageUpload.click();
    });

    imageUpload.addEventListener('change', handleImageUpload);

    addMessage('Please enter the password to start the conversation.');
  </script>

</body>

</html>
